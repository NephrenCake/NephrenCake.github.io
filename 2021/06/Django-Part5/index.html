<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django-Part5 | 浅幽丶奈芙莲的个人博客</title><meta name="author" content="NephrenCake"><meta name="copyright" content="NephrenCake"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="模型层">
<meta property="og:type" content="article">
<meta property="og:title" content="Django-Part5">
<meta property="og:url" content="https://nephrencake.gitee.io/2021/06/Django-Part5/index.html">
<meta property="og:site_name" content="浅幽丶奈芙莲的个人博客">
<meta property="og:description" content="模型层">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://nephrencake.gitee.io/2021/06/Django-Part5/%E4%B8%80ed11.jpg">
<meta property="article:published_time" content="2021-06-18T10:30:40.000Z">
<meta property="article:modified_time" content="2021-06-28T12:29:38.472Z">
<meta property="article:author" content="NephrenCake">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://nephrencake.gitee.io/2021/06/Django-Part5/%E4%B8%80ed11.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://nephrencake.gitee.io/2021/06/Django-Part5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-06-28 20:29:38'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/mouse.css"><link rel="stylesheet" href="/css/scrollbar.css"><link rel="stylesheet" href="/css/font.css"><link rel="stylesheet" href="/css/iconfont.css"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="浅幽丶奈芙莲的个人博客" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">54</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-heart"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/2021/06/Django-Part5/%E4%B8%80ed11.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">浅幽丶奈芙莲的个人博客</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/photo/"><i class="fa-fw fas fa-heart"></i><span> 相册</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友情链接</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Django-Part5</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-06-18T10:30:40.000Z" title="发表于 2021-06-18 18:30:40">2021-06-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-06-28T12:29:38.472Z" title="更新于 2021-06-28 20:29:38">2021-06-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Django/">Django</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">7.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>34分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Django-Part5——模型层"><a href="#Django-Part5——模型层" class="headerlink" title="Django-Part5——模型层"></a>Django-Part5——模型层</h1><p>[TOC]</p>
<h2 id="测试脚本"><a href="#测试脚本" class="headerlink" title="测试脚本"></a>测试脚本</h2><ul>
<li>当只是想测试django项目中的某一个.py文件内容，那么可以不用书写前后端交互的形式，而是直接写一个测试脚本即可。</li>
<li>脚本代码无论是写在应用下的tests.py，还是单独开设.py文件都可以。</li>
<li>django中的文件默认不会暴露出来，需要准备测试环境才能进行测试。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试环境的准备：1. 在manage.py中拷贝前四行代码；2. 额外增加两行代码</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    os.environ.setdefault(<span class="string">&quot;DJANGO_SETTINGS_MODULE&quot;</span>, <span class="string">&quot;djangoProject.settings&quot;</span>)  <span class="comment"># 这里要改成相应的项目名</span></span><br><span class="line">    <span class="keyword">import</span> django</span><br><span class="line">    django.setup()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试代码</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li><p>当<code>from app01 import models</code>写在main之外时，可以通过勾选”使用Python控制台运行”来解决 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44393803/article/details/89739066">https://blog.csdn.net/weixin_44393803/article/details/89739066</a></p>
</li>
<li><p>当不准备环境配置时，可以使用 Python控制台启动 。这样会忽略脚本中的配置环境代码。</p>
</li>
</ul>
<h2 id="单表操作"><a href="#单表操作" class="headerlink" title="单表操作"></a>单表操作</h2><ul>
<li>django自带的sqlite3数据库对日期格式不是很敏感，处理的时候容易出错。</li>
<li>pk会自动查找到当前表的主键字段，指代的就是当前表的主键字段，避免区分当前表的主键字段名uid/pid/sid</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -&gt; test.py</span></span><br><span class="line"><span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 增 1</span></span><br><span class="line">    res = models.User.objects.create(name=<span class="string">&#x27;jason&#x27;</span>, age=<span class="number">18</span>, register_time=<span class="string">&#x27;2002-1-21&#x27;</span>)</span><br><span class="line">    print(res)  <span class="comment"># User object (1)</span></span><br><span class="line">    <span class="comment"># 增 2</span></span><br><span class="line">    user_obj = models.User(name=<span class="string">&#x27;egon&#x27;</span>, age=<span class="number">84</span>, register_time=datetime.datetime.now())</span><br><span class="line">    user_obj.save()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删 1</span></span><br><span class="line">    res = models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">2</span>).delete()</span><br><span class="line">    print(res)  <span class="comment"># (1, &#123;&#x27;app01.User&#x27;: 1&#125;)</span></span><br><span class="line">    <span class="comment"># 删 2</span></span><br><span class="line">    user_obj = models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    user_obj.delete()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 改 1</span></span><br><span class="line">    models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">4</span>).update(name=<span class="string">&#x27;egonDSB&#x27;</span>)</span><br><span class="line">	<span class="comment"># 改 2</span></span><br><span class="line">    user_obj = models.User.objects.get(pk=<span class="number">4</span>)  <span class="comment"># 直接拿到pk=4的数据对象，避免filter+索引</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    get方法直接拿到pk=4的数据对象，避免filter+索引，但是该方法不推荐使用：</span></span><br><span class="line"><span class="string">    	一旦数据不存在该方法会直接报错，而filter则不会。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    user_obj = models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">6</span>).first()</span><br><span class="line">    user_obj.name = <span class="string">&#x27;egonPPP&#x27;</span></span><br><span class="line">    user_obj.save()</span><br></pre></td></tr></table></figure>
<h3 id="必知必会13条"><a href="#必知必会13条" class="headerlink" title="必知必会13条"></a>必知必会13条</h3><ol>
<li><p>all()：查询所有数据</p>
</li>
<li><p>filter()：带有过滤条件的查询</p>
</li>
<li><p>get()：直接拿数据对象，但是条件不存在直接报错</p>
</li>
<li><p>first()：拿queryset里面第一个元素</p>
</li>
<li><p>last()：拿queryset里面最后一个元素</p>
</li>
<li><p>values()：可以指定获取的数据字段，相当于select name,age from …     </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.User.objects.values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">print(res)  <span class="comment"># 列表套字典 &lt;QuerySet [&#123;&#x27;name&#x27;: &#x27;jason&#x27;, &#x27;age&#x27;: 18&#125;, &#123;&#x27;name&#x27;: &#x27;egonPPP&#x27;, &#x27;age&#x27;: 84&#125;]&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>values_list()：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.User.objects.values_list(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">print(res)  <span class="comment"># 列表套元组 &lt;QuerySet [(&#x27;jason&#x27;, 18), (&#x27;egonPPP&#x27;, 84)]&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>distinct()：去重</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.User.objects.values(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>).distinct()</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>去重一定要是一模一样的数据。</p>
<p>例如：.all()的数据带有主键，因此无法去重</p>
</li>
</ul>
</li>
<li><p>order_by()：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>)  <span class="comment"># 默认升序</span></span><br><span class="line">res = models.User.objects.order_by(<span class="string">&#x27;-age&#x27;</span>)  <span class="comment"># 降序</span></span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure></li>
<li><p>reverse()：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    res = models.User.objects.<span class="built_in">all</span>()</span><br><span class="line">    res1 = models.User.objects.order_by(<span class="string">&#x27;age&#x27;</span>).reverse()</span><br><span class="line">    print(res,res1)</span><br><span class="line"></span><br><span class="line"><span class="number">11.</span> count()：统计当前数据的个数</span><br><span class="line"></span><br><span class="line">    ```python</span><br><span class="line">    res = models.User.objects.count()</span><br><span class="line">    print(res)</span><br><span class="line"></span><br><span class="line"><span class="number">12.</span> exclude()：排除在外</span><br><span class="line"></span><br><span class="line">    ```python</span><br><span class="line">    res = models.User.objects.exclude(name=<span class="string">&#x27;jason&#x27;</span>)</span><br><span class="line">    print(res)</span><br></pre></td></tr></table></figure></li>
<li><p>exists()：基本用不到因为数据本身就自带布尔值  返回的是布尔值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">res = models.User.objects.<span class="built_in">filter</span>(pk=<span class="number">10</span>).exists()</span><br><span class="line">print(res)</span><br></pre></td></tr></table></figure>
<h3 id="查看内部sql语句的方式"><a href="#查看内部sql语句的方式" class="headerlink" title="查看内部sql语句的方式"></a>查看内部sql语句的方式</h3></li>
<li><p>QuerySet类对象可以使用.query查看内部封装的sql语句</p>
</li>
<li><p>在配置文件中配置logging，查看所有的sql语句</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方式1</span></span><br><span class="line">res = models.User.objects.values_list(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">print(res.query)  <span class="comment"># SELECT `app01_user`.`name`, `app01_user`.`age` FROM `app01_user`</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 方式2</span></span><br><span class="line">LOGGING = &#123;</span><br><span class="line">    <span class="string">&#x27;version&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;disable_existing_loggers&#x27;</span>: <span class="literal">False</span>,</span><br><span class="line">    <span class="string">&#x27;handlers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;console&#x27;</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>:<span class="string">&#x27;logging.StreamHandler&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&#x27;loggers&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;django.db.backends&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;handlers&#x27;</span>: [<span class="string">&#x27;console&#x27;</span>],</span><br><span class="line">            <span class="string">&#x27;propagate&#x27;</span>: <span class="literal">True</span>,</span><br><span class="line">            <span class="string">&#x27;level&#x27;</span>:<span class="string">&#x27;DEBUG&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="双下划线查询"><a href="#双下划线查询" class="headerlink" title="双下划线查询"></a>双下划线查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 神奇的双下划线查询</span></span><br><span class="line">    <span class="comment"># 1 年龄大于35岁的数据</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(age__gt=35)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 2 年龄小于35岁的数据</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(age__lt=35)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 大于等于 小于等于</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(age__gte=32)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(age__lte=32)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 年龄是18 或者 32 或者40</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(age__in=[18,32,40])</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 年龄在18到40岁之间的  首尾都要</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(age__range=[18,40])</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询出名字里面含有s的数据  模糊查询</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(name__contains=&#x27;s&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># 是否区分大小写  查询出名字里面含有p的数据  区分大小写</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(name__contains=&#x27;p&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># 忽略大小写</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(name__icontains=&#x27;p&#x27;)</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(name__startswith=&#x27;j&#x27;)</span></span><br><span class="line">    <span class="comment"># res1 = models.User.objects.filter(name__endswith=&#x27;j&#x27;)</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(res,res1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 查询出注册时间是 2020 1月</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(register_time__month=&#x27;1&#x27;)</span></span><br><span class="line">    <span class="comment"># res = models.User.objects.filter(register_time__year=&#x27;2020&#x27;)</span></span><br></pre></td></tr></table></figure>
<h3 id="一对多外键增删改查"><a href="#一对多外键增删改查" class="headerlink" title="一对多外键增删改查"></a>一对多外键增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 一对多外键增删改查</span></span><br><span class="line">    <span class="comment"># 增</span></span><br><span class="line">    <span class="comment"># 1  直接写实际字段 id</span></span><br><span class="line">    <span class="comment"># models.Book.objects.create(title=&#x27;论语&#x27;,price=899.23,publish_id=1)</span></span><br><span class="line">    <span class="comment"># models.Book.objects.create(title=&#x27;聊斋&#x27;,price=444.23,publish_id=2)</span></span><br><span class="line">    <span class="comment"># models.Book.objects.create(title=&#x27;老子&#x27;,price=333.66,publish_id=1)</span></span><br><span class="line">    <span class="comment"># 2  虚拟字段 对象</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(pk=2).first()</span></span><br><span class="line">    <span class="comment"># models.Book.objects.create(title=&#x27;红楼梦&#x27;,price=666.23,publish=publish_obj)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">    <span class="comment"># models.Publish.objects.filter(pk=1).delete()  # 级联删除</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改</span></span><br><span class="line">    <span class="comment"># models.Book.objects.filter(pk=1).update(publish_id=2)</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(pk=1).first()</span></span><br><span class="line">    <span class="comment"># models.Book.objects.filter(pk=1).update(publish=publish_obj)</span></span><br></pre></td></tr></table></figure>
<h3 id="多对多外键增删改查"><a href="#多对多外键增删改查" class="headerlink" title="多对多外键增删改查"></a>多对多外键增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何给书籍添加作者？</span></span><br><span class="line">    book_obj = models.Book.objects.<span class="built_in">filter</span>(pk=<span class="number">1</span>).first()</span><br><span class="line">    <span class="comment"># print(book_obj.authors)  # 就类似于你已经到了第三张关系表了</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(1)  # 书籍id为1的书籍绑定一个主键为1 的作者</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(2,3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(pk=1).first()</span></span><br><span class="line">    <span class="comment"># author_obj1 = models.Author.objects.filter(pk=2).first()</span></span><br><span class="line">    <span class="comment"># author_obj2 = models.Author.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(author_obj)</span></span><br><span class="line">    <span class="comment"># book_obj.authors.add(author_obj1,author_obj2)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    add给第三张关系表添加数据</span></span><br><span class="line"><span class="string">        括号内既可以传数字也可以传对象 并且都支持多个</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 删</span></span><br><span class="line">    <span class="comment"># book_obj.authors.remove(2)</span></span><br><span class="line">    <span class="comment"># book_obj.authors.remove(1,3)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(pk=2).first()</span></span><br><span class="line">    <span class="comment"># author_obj1 = models.Author.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># book_obj.authors.remove(author_obj,author_obj1)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    remove</span></span><br><span class="line"><span class="string">        括号内既可以传数字也可以传对象 并且都支持多个</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 修改</span></span><br><span class="line">    <span class="comment"># book_obj.authors.set([1,2])  # 括号内必须给一个可迭代对象</span></span><br><span class="line">    <span class="comment"># book_obj.authors.set([3])  # 括号内必须给一个可迭代对象</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(pk=2).first()</span></span><br><span class="line">    <span class="comment"># author_obj1 = models.Author.objects.filter(pk=3).first()</span></span><br><span class="line">    <span class="comment"># book_obj.authors.set([author_obj,author_obj1])  # 括号内必须给一个可迭代对象</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    set</span></span><br><span class="line"><span class="string">        括号内必须传一个可迭代对象，该对象内既可以数字也可以对象 并且都支持多个</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 清空</span></span><br><span class="line">    <span class="comment"># 在第三张关系表中清空某个书籍与作者的绑定关系</span></span><br><span class="line">    book_obj.authors.clear()</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    clear</span></span><br><span class="line"><span class="string">        括号内不要加任何参数</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="正反向的概念"><a href="#正反向的概念" class="headerlink" title="正反向的概念"></a>正反向的概念</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 正向</span></span><br><span class="line"><span class="comment"># 反向</span></span><br><span class="line">	外键字段在我手上那么，我查你就是正向</span><br><span class="line">  外键字段如果不在手上，我查你就是反向</span><br><span class="line">  </span><br><span class="line">  book &gt;&gt;&gt;外键字段在书那儿(正向)&gt;&gt;&gt; publish</span><br><span class="line">  publish	&gt;&gt;&gt;外键字段在书那儿(反向)&gt;&gt;&gt;book</span><br><span class="line">  </span><br><span class="line">  一对一和多对多正反向的判断也是如此</span><br><span class="line">  </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">正向查询按字段</span></span><br><span class="line"><span class="string">反向查询按表名小写</span></span><br><span class="line"><span class="string">				_set</span></span><br><span class="line"><span class="string">				...</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="多表查询"><a href="#多表查询" class="headerlink" title="多表查询"></a>多表查询</h2><h3 id="子查询-基于对象的跨表查询"><a href="#子查询-基于对象的跨表查询" class="headerlink" title="子查询(基于对象的跨表查询)"></a>子查询(基于对象的跨表查询)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.查询书籍主键为1的出版社</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=1).first()</span></span><br><span class="line">    <span class="comment"># # 书查出版社 正向</span></span><br><span class="line">    <span class="comment"># res = book_obj.publish</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.name)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 2.查询书籍主键为2的作者</span></span><br><span class="line">    <span class="comment"># book_obj = models.Book.objects.filter(pk=2).first()</span></span><br><span class="line">    <span class="comment"># # 书查作者 正向</span></span><br><span class="line">    <span class="comment"># # res = book_obj.authors  # app01.Author.None</span></span><br><span class="line">    <span class="comment"># res = book_obj.authors.all()  # &lt;QuerySet [&lt;Author: Author object&gt;, &lt;Author: Author object&gt;]&gt;</span></span><br><span class="line">    <span class="comment">#</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3.查询作者jason的电话号码</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># res = author_obj.author_detail</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line">    <span class="comment"># print(res.phone)</span></span><br><span class="line">    <span class="comment"># print(res.addr)</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    在书写orm语句的时候跟写sql语句一样的</span></span><br><span class="line"><span class="string">    不要企图一次性将orm语句写完 如果比较复杂 就写一点看一点</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    正向什么时候需要加.all()</span></span><br><span class="line"><span class="string">        当你的结果可能有多个的时候就需要加.all()</span></span><br><span class="line"><span class="string">        如果是一个则直接拿到数据对象</span></span><br><span class="line"><span class="string">            book_obj.publish</span></span><br><span class="line"><span class="string">            book_obj.authors.all()</span></span><br><span class="line"><span class="string">            author_obj.author_detail</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 4.查询出版社是东方出版社出版的书</span></span><br><span class="line">    <span class="comment"># publish_obj = models.Publish.objects.filter(name=&#x27;东方出版社&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 出版社查书  反向</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = publish_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 5.查询作者是jason写过的书</span></span><br><span class="line">    <span class="comment"># author_obj = models.Author.objects.filter(name=&#x27;jason&#x27;).first()</span></span><br><span class="line">    <span class="comment"># 作者查书      反向</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set  # app01.Book.None</span></span><br><span class="line">    <span class="comment"># res = author_obj.book_set.all()</span></span><br><span class="line">    <span class="comment"># print(res)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6.查询手机号是110的作者姓名</span></span><br><span class="line">    <span class="comment"># author_detail_obj = models.AuthorDetail.objects.filter(phone=110).first()</span></span><br><span class="line">    <span class="comment"># res = author_detail_obj.author</span></span><br><span class="line">    <span class="comment"># print(res.name)</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    基于对象 </span></span><br><span class="line"><span class="string">        反向查询的时候</span></span><br><span class="line"><span class="string">            当你的查询结果可以有多个的时候 就必须加_set.all()</span></span><br><span class="line"><span class="string">            当你的结果只有一个的时候 不需要加_set.all()</span></span><br><span class="line"><span class="string">        自己总结出 自己方便记忆的即可 每个人都可以不一样</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="联表查询-基于双下划线的跨表查询"><a href="#联表查询-基于双下划线的跨表查询" class="headerlink" title="联表查询(基于双下划线的跨表查询)"></a>联表查询(基于双下划线的跨表查询)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基于双下划线的跨表查询    # 1.查询jason的手机号和作者姓名    # res = models.Author.objects.filter(name=&#x27;jason&#x27;).values(&#x27;author_detail__phone&#x27;,&#x27;name&#x27;)    # print(res)    # 反向    # res = models.AuthorDetail.objects.filter(author__name=&#x27;jason&#x27;)  # 拿作者姓名是jason的作者详情    # res = models.AuthorDetail.objects.filter(author__name=&#x27;jason&#x27;).values(&#x27;phone&#x27;,&#x27;author__name&#x27;)    # print(res)    # 2.查询书籍主键为1的出版社名称和书的名称    # res = models.Book.objects.filter(pk=1).values(&#x27;title&#x27;,&#x27;publish__name&#x27;)    # print(res)    # 反向    # res = models.Publish.objects.filter(book__id=1).values(&#x27;name&#x27;,&#x27;book__title&#x27;)    # print(res)    # 3.查询书籍主键为1的作者姓名    # res = models.Book.objects.filter(pk=1).values(&#x27;authors__name&#x27;)    # print(res)    # 反向    # res = models.Author.objects.filter(book__id=1).values(&#x27;name&#x27;)    # print(res)    # 查询书籍主键是1的作者的手机号    # book author authordetail    # res = models.Book.objects.filter(pk=1).values(&#x27;authors__author_detail__phone&#x27;)    # print(res)    &quot;&quot;&quot;    你只要掌握了正反向的概念    以及双下划线    那么你就可以无限制的跨表        &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="聚合查询"><a href="#聚合查询" class="headerlink" title="聚合查询"></a>聚合查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 聚合查询      aggregate    &quot;&quot;&quot;    聚合查询通常情况下都是配合分组一起使用的    只要是跟数据库相关的模块         基本上都在django.db.models里面        如果上述没有那么应该在django.db里面    &quot;&quot;&quot;    from app01 import models    from django.db.models import Max,Min,Sum,Count,Avg    # 1 所有书的平均价格    # res = models.Book.objects.aggregate(Avg(&#x27;price&#x27;))    # print(res)    # 2.上述方法一次性使用    res = models.Book.objects.aggregate(Max(&#x27;price&#x27;),Min(&#x27;price&#x27;),Sum(&#x27;price&#x27;),Count(&#x27;pk&#x27;),Avg(&#x27;price&#x27;))    print(res)</span></span><br></pre></td></tr></table></figure>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分组查询  annotate    &quot;&quot;&quot;    MySQL分组查询都有哪些特点        分组之后默认只能获取到分组的依据 组内其他字段都无法直接获取了            严格模式                ONLY_FULL_GROUP_BY                    &quot;&quot;&quot;    from django.db.models import Max, Min, Sum, Count, Avg    # 1.统计每一本书的作者个数    # res = models.Book.objects.annotate()  # models后面点什么 就是按什么分组    # res = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;)).values(&#x27;title&#x27;,&#x27;author_num&#x27;)    &quot;&quot;&quot;    author_num是我们自己定义的字段 用来存储统计出来的每本书对应的作者个数    &quot;&quot;&quot;    # res1 = models.Book.objects.annotate(author_num=Count(&#x27;authors__id&#x27;)).values(&#x27;title&#x27;,&#x27;author_num&#x27;)    # print(res,res1)    &quot;&quot;&quot;    代码没有补全 不要怕 正常写    补全给你是pycharm给你的 到后面在服务器上直接书写代码 什么补全都没有 颜色提示也没有        &quot;&quot;&quot;    # 2.统计每个出版社卖的最便宜的书的价格(作业:复习原生SQL语句 写出来)    # res = models.Publish.objects.annotate(min_price=Min(&#x27;book__price&#x27;)).values(&#x27;name&#x27;,&#x27;min_price&#x27;)    # print(res)    # 3.统计不止一个作者的图书        # 1.先按照图书分组 求每一本书对应的作者个数        # 2.过滤出不止一个作者的图书    # res = models.Book.objects.annotate(author_num=Count(&#x27;authors&#x27;)).filter(author_num__gt=1).values(&#x27;title&#x27;,&#x27;author_num&#x27;)    # &quot;&quot;&quot;    # 只要你的orm语句得出的结果还是一个queryset对象    # 那么它就可以继续无限制的点queryset对象封装的方法    #    # &quot;&quot;&quot;    # print(res)    # 4.查询每个作者出的书的总价格    # res = models.Author.objects.annotate(sum_price=Sum(&#x27;book__price&#x27;)).values(&#x27;name&#x27;,&#x27;sum_price&#x27;)    # print(res)    &quot;&quot;&quot;    如果我想按照指定的字段分组该如何处理呢？        models.Book.objects.values(&#x27;price&#x27;).annotate()    后续BBS作业会使用            你们的机器上如果出现分组查询报错的情况        你需要修改数据库严格模式    &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="F与Q查询"><a href="#F与Q查询" class="headerlink" title="F与Q查询"></a>F与Q查询</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F查询    # 1.查询卖出数大于库存数的书籍    # F查询    &quot;&quot;&quot;    能够帮助你直接获取到表中某个字段对应的数据    &quot;&quot;&quot;    from django.db.models import F    # res = models.Book.objects.filter(maichu__gt=F(&#x27;kucun&#x27;))    # print(res)    # 2.将所有书籍的价格提升500块    # models.Book.objects.update(price=F(&#x27;price&#x27;) + 500)    # 3.将所有书的名称后面加上爆款两个字    &quot;&quot;&quot;    在操作字符类型的数据的时候 F不能够直接做到字符串的拼接    &quot;&quot;&quot;    from django.db.models.functions import Concat    from django.db.models import Value    models.Book.objects.update(title=Concat(F(&#x27;title&#x27;), Value(&#x27;爆款&#x27;)))    # models.Book.objects.update(title=F(&#x27;title&#x27;) + &#x27;爆款&#x27;)  # 所有的名称会全部变成空白</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Q查询    # 1.查询卖出数大于100或者价格小于600的书籍    # res = models.Book.objects.filter(maichu__gt=100,price__lt=600)    &quot;&quot;&quot;filter括号内多个参数是and关系&quot;&quot;&quot;    from django.db.models import Q    # res = models.Book.objects.filter(Q(maichu__gt=100),Q(price__lt=600))  # Q包裹逗号分割 还是and关系    # res = models.Book.objects.filter(Q(maichu__gt=100)|Q(price__lt=600))  # | or关系    # res = models.Book.objects.filter(~Q(maichu__gt=100)|Q(price__lt=600))  # ~ not关系    # print(res)  # &lt;QuerySet []&gt;    # Q的高阶用法  能够将查询条件的左边也变成字符串的形式    q = Q()    q.connector = &#x27;or&#x27;    q.children.append((&#x27;maichu__gt&#x27;,100))    q.children.append((&#x27;price__lt&#x27;,600))    res = models.Book.objects.filter(q)  # 默认还是and关系    print(res)</span></span><br></pre></td></tr></table></figure>
<h3 id="django中如何开启事务"><a href="#django中如何开启事务" class="headerlink" title="django中如何开启事务"></a>django中如何开启事务</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;事务	ACID		原子性			不可分割的最小单位		一致性			跟原子性是相辅相成		隔离性			事务之间互相不干扰		持久性			事务一旦确认永久生效		事务的回滚 		rollback	事务的确认		commit&quot;&quot;&quot;</span><span class="comment"># 目前你只需要掌握Django中如何简单的开启事务# 事务    from django.db import transaction    try:        with transaction.atomic():            # sql1            # sql2            ...            # 在with代码快内书写的所有orm操作都是属于同一个事务    except Exception as e:        print(e)    print(&#x27;执行其他操作&#x27;)</span></span><br></pre></td></tr></table></figure>
<h3 id="orm中常用字段及参数"><a href="#orm中常用字段及参数" class="headerlink" title="orm中常用字段及参数"></a>orm中常用字段及参数</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AutoField	主键字段 primary_key=<span class="literal">True</span>  CharField				varchar	verbose_name	字段的注释  max_length		长度  IntegerField			intBigIntegerField		bigintDecimalField	max_digits=<span class="number">8</span>  decimal_places=2EmailFiled				varchar(<span class="number">254</span>)DateField					dateDateTimeField			datetime	auto_now:每次修改数据的时候都会自动更新当前时间  auto_now_add:只在创建数据的时候记录创建时间后续不会自动修改了    BooleanField(Field)				- 布尔值类型	该字段传布尔值(<span class="literal">False</span>/<span class="literal">True</span>) 	数据库里面存<span class="number">0</span>/1TextField(Field)					- 文本类型	该字段可以用来存大段内容(文章、博客...)  没有字数限制  后面的bbs作业 文章字段用的就是TextFieldFileField(Field)					- 字符类型   upload_to = <span class="string">&quot;/data&quot;</span>  给该字段传一个文件对象，会自动将文件保存到/data目录下然后将文件路径保存到数据库中  /data/a.txt  后面bbs作业也会涉及<span class="comment"># 更多字段直接参考博客:https://www.cnblogs.com/Dominic-Ji/p/9203990.html    # django除了给你提供了很多字段类型之外 还支持你自定义字段class MyCharField(models.Field):    def __init__(self,max_length,*args,**kwargs):        self.max_length = max_length        # 调用父类的init方法        super().__init__(max_length=max_length,*args,**kwargs)  # 一定要是关键字的形式传入    def db_type(self, connection):        &quot;&quot;&quot;        返回真正的数据类型及各种约束条件        :param connection:        :return:        &quot;&quot;&quot;        return &#x27;char(%s)&#x27;%self.max_length# 自定义字段使用myfield = MyCharField(max_length=16,null=True)# 外键字段及参数unique=True	ForeignKey(unique=True)   ===			OneToOneField()  # 你在用前面字段创建一对一 orm会有一个提示信息 orm推荐你使用后者但是前者也能用  db_index	如果db_index=True 则代表着为此字段设置索引  (复习索引是什么)to_field	设置要关联的表的字段  默认不写关联的就是另外一张的主键字段on_delete	当删除关联表中的数据时，当前表与其关联的行的行为。  &quot;&quot;&quot;  django2.X及以上版本 需要你自己指定外键字段的级联更新级联删除  &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="数据库查询优化"><a href="#数据库查询优化" class="headerlink" title="数据库查询优化"></a>数据库查询优化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">only与defer	select_related与prefetch_related<span class="string">&quot;&quot;&quot;orm语句的特点:	惰性查询		如果你仅仅只是书写了orm语句 在后面根本没有用到该语句所查询出来的参数		那么orm会自动识别 直接不执行&quot;&quot;&quot;</span><span class="comment"># only与defer# res = models.Book.objects.all()    # print(res)  # 要用数据了才会走数据库    # 想要获取书籍表中所有数的名字    # res = models.Book.objects.values(&#x27;title&#x27;)    # for d in res:    #     print(d.get(&#x27;title&#x27;))    # 你给我实现获取到的是一个数据对象 然后点title就能够拿到书名 并且没有其他字段    # res = models.Book.objects.only(&#x27;title&#x27;)    # res = models.Book.objects.all()    # print(res)  # &lt;QuerySet [&lt;Book: 三国演义爆款&gt;, &lt;Book: 红楼梦爆款&gt;, &lt;Book: 论语爆款&gt;, &lt;Book: 聊斋爆款&gt;, &lt;Book: 老子爆款&gt;]&gt;    # for i in res:        # print(i.title)  # 点击only括号内的字段 不会走数据库        # print(i.price)  # 点击only括号内没有的字段 会重新走数据库查询而all不需要走了    res = models.Book.objects.defer(&#x27;title&#x27;)  # 对象除了没有title属性之外其他的都有    for i in res:        print(i.price)    &quot;&quot;&quot;    defer与only刚好相反        defer括号内放的字段不在查询出来的对象里面 查询该字段需要重新走数据        而如果查询的是非括号内的字段 则不需要走数据库了    &quot;&quot;&quot;    # select_related与prefetch_related# select_related与prefetch_related  跟跨表操作有关    # res = models.Book.objects.all()    # for i in res:    #     print(i.publish.name)  # 每循环一次就要走一次数据库查询    # res = models.Book.objects.select_related(&#x27;authors&#x27;)  # INNER JOIN    &quot;&quot;&quot;    select_related内部直接先将book与publish连起来 然后一次性将大表里面的所有数据    全部封装给查询出来的对象        这个时候对象无论是点击book表的数据还是publish的数据都无需再走数据库查询了        select_related括号内只能放外键字段    一对多 一对一        多对多也不行        &quot;&quot;&quot;    # for i in res:    #     print(i.publish.name)  # 每循环一次就要走一次数据库查询    res = models.Book.objects.prefetch_related(&#x27;publish&#x27;)  # 子查询    &quot;&quot;&quot;    prefetch_related该方法内部其实就是子查询        将子查询查询出来的所有结果也给你封装到对象中        给你的感觉好像也是一次性搞定的    &quot;&quot;&quot;    for i in res:        print(i.publish.name)</span></span><br></pre></td></tr></table></figure>
<h3 id="图书管理的图书增删改查"><a href="#图书管理的图书增删改查" class="headerlink" title="图书管理的图书增删改查"></a>图书管理的图书增删改查</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render,redirect,HttpResponsefrom app01 <span class="keyword">import</span> models<span class="comment"># Create your views here.def home(request):    return render(request,&#x27;home.html&#x27;)def book_list(request):    # 先查询出所有的书籍信息 传递给html页面    book_queryset = models.Book.objects.all()    return render(request,&#x27;book_list.html&#x27;,locals())def book_add(request):    if request.method == &#x27;POST&#x27;:        # 获取前端提交过来的所有数据        title = request.POST.get(&quot;title&quot;)        price = request.POST.get(&quot;price&quot;)        publish_date = request.POST.get(&quot;publish_date&quot;)        publish_id = request.POST.get(&quot;publish&quot;)        authors_list = request.POST.getlist(&quot;authors&quot;)  # [1,2,3,4,]        # 操作数据库存储数据        # 书籍表        book_obj = models.Book.objects.create(title=title,price=price,publish_date=publish_date,publish_id=publish_id)        # 书籍与作者的关系表        book_obj.authors.add(*authors_list)        # 跳转到书籍的展示页面        &quot;&quot;&quot;        redirect括号内可以直接写url        其实也可以直接写别名                但是如果你的别名需要额外给参数的话，那么就必须使用reverse解析了        &quot;&quot;&quot;        return redirect(&#x27;book_list&#x27;)    # 先获取当前系统中所有的出版社信息和作者信息    publish_queryset = models.Publish.objects.all()    author_queryset = models.Author.objects.all()    return render(request,&#x27;book_add.html&#x27;,locals())def book_edit(request,edit_id):    # 获取当前用户想要编辑的书籍对象 展示给用户看    edit_obj = models.Book.objects.filter(pk=edit_id).first()    if request.method == &#x27;POST&#x27;:        title = request.POST.get(&quot;title&quot;)        price = request.POST.get(&quot;price&quot;)        publish_date = request.POST.get(&quot;publish_date&quot;)        publish_id = request.POST.get(&quot;publish&quot;)        authors_list = request.POST.getlist(&quot;authors&quot;)  # [1,2,3,4,]        models.Book.objects.filter(pk=edit_id).update(title=title,                                                      price=price,                                                      publish_date=publish_date,                                                      publish_id=publish_id                                                      )        # 该第三张关系表        edit_obj.authors.set(authors_list)        return redirect(&#x27;book_list&#x27;)    publish_queryset = models.Publish.objects.all()    author_queryset = models.Author.objects.all()    return render(request,&#x27;book_edit.html&#x27;,locals())def book_delete(request,delete_id):    # 简单粗暴 直接删除    models.Book.objects.filter(pk=delete_id).delete()    # 直接跳转到展示页    return redirect(&#x27;book_list&#x27;)</span></span><br></pre></td></tr></table></figure>
<h3 id="choices参数-数据库字段设计常见"><a href="#choices参数-数据库字段设计常见" class="headerlink" title="choices参数(数据库字段设计常见)"></a>choices参数(数据库字段设计常见)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;用户表		性别	学历	工作经验	是否结婚	是否生子	客户来源	...针对某个可以列举完全的可能性字段，我们应该如何存储只要某个字段的可能性是可以列举完全的，那么一般情况下都会采用choices参数&quot;&quot;&quot;</span><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">models.Model</span>):</span>    username = models.CharField(max_length=<span class="number">32</span>)    age = models.IntegerField()    <span class="comment"># 性别    gender_choices = (        (1,&#x27;男&#x27;),        (2,&#x27;女&#x27;),        (3,&#x27;其他&#x27;),    )    gender = models.IntegerField(choices=gender_choices)        score_choices = (        (&#x27;A&#x27;,&#x27;优秀&#x27;),        (&#x27;B&#x27;,&#x27;良好&#x27;),        (&#x27;C&#x27;,&#x27;及格&#x27;),        (&#x27;D&#x27;,&#x27;不合格&#x27;),    )    # 保证字段类型跟列举出来的元祖第一个数据类型一致即可    score = models.CharField(choices=score_choices,null=True)    &quot;&quot;&quot;    该gender字段存的还是数字 但是如果存的数字在上面元祖列举的范围之内    那么可以非常轻松的获取到数字对应的真正的内容        1.gender字段存的数字不在上述元祖列举的范围内容    2.如果在 如何获取对应的中文信息    &quot;&quot;&quot;              from app01 import models    # models.User.objects.create(username=&#x27;jason&#x27;,age=18,gender=1)    # models.User.objects.create(username=&#x27;egon&#x27;,age=85,gender=2)    # models.User.objects.create(username=&#x27;tank&#x27;,age=40,gender=3)    # 存的时候 没有列举出来的数字也能存（范围还是按照字段类型决定）    # models.User.objects.create(username=&#x27;tony&#x27;,age=45,gender=4)    # 取    # user_obj = models.User.objects.filter(pk=1).first()    # print(user_obj.gender)    # 只要是choices参数的字段 如果你想要获取对应信息 固定写法 get_字段名_display()    # print(user_obj.get_gender_display())    user_obj = models.User.objects.filter(pk=4).first()    # 如果没有对应关系 那么字段是什么还是展示什么    print(user_obj.get_gender_display())  # 4     # 实际项目案例# CRM相关内部表class School(models.Model):    &quot;&quot;&quot;    校区表    如：        北京沙河校区        上海校区    &quot;&quot;&quot;    title = models.CharField(verbose_name=&#x27;校区名称&#x27;, max_length=32)    def __str__(self):        return self.titleclass Course(models.Model):    &quot;&quot;&quot;    课程表    如：        Linux基础        Linux架构师        Python自动化开发精英班        Python自动化开发架构师班        Python基础班        go基础班    &quot;&quot;&quot;    name = models.CharField(verbose_name=&#x27;课程名称&#x27;, max_length=32)    def __str__(self):        return self.nameclass Department(models.Model):    &quot;&quot;&quot;    部门表    市场部     1000    销售       1001    &quot;&quot;&quot;    title = models.CharField(verbose_name=&#x27;部门名称&#x27;, max_length=16)    code = models.IntegerField(verbose_name=&#x27;部门编号&#x27;, unique=True, null=False)    def __str__(self):        return self.titleclass UserInfo(models.Model):    &quot;&quot;&quot;    员工表    &quot;&quot;&quot;    name = models.CharField(verbose_name=&#x27;员工姓名&#x27;, max_length=16)    email = models.EmailField(verbose_name=&#x27;邮箱&#x27;, max_length=64)    depart = models.ForeignKey(verbose_name=&#x27;部门&#x27;, to=&quot;Department&quot;,to_field=&quot;code&quot;)    user=models.OneToOneField(&quot;User&quot;,default=1)    def __str__(self):        return self.nameclass ClassList(models.Model):    &quot;&quot;&quot;    班级表    如：        Python全栈  面授班  5期  10000  2017-11-11  2018-5-11    &quot;&quot;&quot;    school = models.ForeignKey(verbose_name=&#x27;校区&#x27;, to=&#x27;School&#x27;)    course = models.ForeignKey(verbose_name=&#x27;课程名称&#x27;, to=&#x27;Course&#x27;)    semester = models.IntegerField(verbose_name=&quot;班级(期)&quot;)    price = models.IntegerField(verbose_name=&quot;学费&quot;)    start_date = models.DateField(verbose_name=&quot;开班日期&quot;)    graduate_date = models.DateField(verbose_name=&quot;结业日期&quot;, null=True, blank=True)    memo = models.CharField(verbose_name=&#x27;说明&#x27;, max_length=256, blank=True, null=True, )    teachers = models.ManyToManyField(verbose_name=&#x27;任课老师&#x27;, to=&#x27;UserInfo&#x27;,limit_choices_to=&#123;&#x27;depart&#x27;:1002&#125;)    tutor = models.ForeignKey(verbose_name=&#x27;班主任&#x27;, to=&#x27;UserInfo&#x27;,related_name=&quot;class_list&quot;,limit_choices_to=&#123;&#x27;depart&#x27;:1006&#125;)    def __str__(self):        return &quot;&#123;0&#125;(&#123;1&#125;期)&quot;.format(self.course.name, self.semester)class Customer(models.Model):    &quot;&quot;&quot;    客户表    &quot;&quot;&quot;    qq = models.CharField(verbose_name=&#x27;qq&#x27;, max_length=64, unique=True, help_text=&#x27;QQ号必须唯一&#x27;)    name = models.CharField(verbose_name=&#x27;学生姓名&#x27;, max_length=16)    gender_choices = ((1, &#x27;男&#x27;), (2, &#x27;女&#x27;))    gender = models.SmallIntegerField(verbose_name=&#x27;性别&#x27;, choices=gender_choices)    education_choices = (        (1, &#x27;重点大学&#x27;),        (2, &#x27;普通本科&#x27;),        (3, &#x27;独立院校&#x27;),        (4, &#x27;民办本科&#x27;),        (5, &#x27;大专&#x27;),        (6, &#x27;民办专科&#x27;),        (7, &#x27;高中&#x27;),        (8, &#x27;其他&#x27;)    )    education = models.IntegerField(verbose_name=&#x27;学历&#x27;, choices=education_choices, blank=True, null=True, )    graduation_school = models.CharField(verbose_name=&#x27;毕业学校&#x27;, max_length=64, blank=True, null=True)    major = models.CharField(verbose_name=&#x27;所学专业&#x27;, max_length=64, blank=True, null=True)    experience_choices = [        (1, &#x27;在校生&#x27;),        (2, &#x27;应届毕业&#x27;),        (3, &#x27;半年以内&#x27;),        (4, &#x27;半年至一年&#x27;),        (5, &#x27;一年至三年&#x27;),        (6, &#x27;三年至五年&#x27;),        (7, &#x27;五年以上&#x27;),    ]    experience = models.IntegerField(verbose_name=&#x27;工作经验&#x27;, blank=True, null=True, choices=experience_choices)    work_status_choices = [        (1, &#x27;在职&#x27;),        (2, &#x27;无业&#x27;)    ]    work_status = models.IntegerField(verbose_name=&quot;职业状态&quot;, choices=work_status_choices, default=1, blank=True,                                      null=True)    company = models.CharField(verbose_name=&quot;目前就职公司&quot;, max_length=64, blank=True, null=True)    salary = models.CharField(verbose_name=&quot;当前薪资&quot;, max_length=64, blank=True, null=True)    source_choices = [        (1, &quot;qq群&quot;),        (2, &quot;内部转介绍&quot;),        (3, &quot;官方网站&quot;),        (4, &quot;百度推广&quot;),        (5, &quot;360推广&quot;),        (6, &quot;搜狗推广&quot;),        (7, &quot;腾讯课堂&quot;),        (8, &quot;广点通&quot;),        (9, &quot;高校宣讲&quot;),        (10, &quot;渠道代理&quot;),        (11, &quot;51cto&quot;),        (12, &quot;智汇推&quot;),        (13, &quot;网盟&quot;),        (14, &quot;DSP&quot;),        (15, &quot;SEO&quot;),        (16, &quot;其它&quot;),    ]    source = models.SmallIntegerField(&#x27;客户来源&#x27;, choices=source_choices, default=1)    referral_from = models.ForeignKey(        &#x27;self&#x27;,        blank=True,        null=True,        verbose_name=&quot;转介绍自学员&quot;,        help_text=&quot;若此客户是转介绍自内部学员,请在此处选择内部学员姓名&quot;,        related_name=&quot;internal_referral&quot;    )    course = models.ManyToManyField(verbose_name=&quot;咨询课程&quot;, to=&quot;Course&quot;)    status_choices = [        (1, &quot;已报名&quot;),        (2, &quot;未报名&quot;)    ]    status = models.IntegerField(        verbose_name=&quot;状态&quot;,        choices=status_choices,        default=2,        help_text=u&quot;选择客户此时的状态&quot;    )    consultant = models.ForeignKey(verbose_name=&quot;课程顾问&quot;, to=&#x27;UserInfo&#x27;, related_name=&#x27;consultanter&#x27;,limit_choices_to=&#123;&#x27;depart&#x27;:1001&#125;)    date = models.DateField(verbose_name=&quot;咨询日期&quot;, auto_now_add=True)    recv_date = models.DateField(verbose_name=&quot;当前课程顾问的接单日期&quot;, null=True)    last_consult_date = models.DateField(verbose_name=&quot;最后跟进日期&quot;, )    def __str__(self):        return self.nameclass ConsultRecord(models.Model):    &quot;&quot;&quot;    客户跟进记录    &quot;&quot;&quot;    customer = models.ForeignKey(verbose_name=&quot;所咨询客户&quot;, to=&#x27;Customer&#x27;)    consultant = models.ForeignKey(verbose_name=&quot;跟踪人&quot;, to=&#x27;UserInfo&#x27;,limit_choices_to=&#123;&#x27;depart&#x27;:1001&#125;)    date = models.DateField(verbose_name=&quot;跟进日期&quot;, auto_now_add=True)    note = models.TextField(verbose_name=&quot;跟进内容...&quot;)    def __str__(self):        return self.customer.name + &quot;:&quot; + self.consultant.nameclass Student(models.Model):    &quot;&quot;&quot;    学生表（已报名）    &quot;&quot;&quot;    customer = models.OneToOneField(verbose_name=&#x27;客户信息&#x27;, to=&#x27;Customer&#x27;)    class_list = models.ManyToManyField(verbose_name=&quot;已报班级&quot;, to=&#x27;ClassList&#x27;, blank=True)    emergency_contract = models.CharField(max_length=32, blank=True, null=True, verbose_name=&#x27;紧急联系人&#x27;)    company = models.CharField(verbose_name=&#x27;公司&#x27;, max_length=128, blank=True, null=True)    location = models.CharField(max_length=64, verbose_name=&#x27;所在区域&#x27;, blank=True, null=True)    position = models.CharField(verbose_name=&#x27;岗位&#x27;, max_length=64, blank=True, null=True)    salary = models.IntegerField(verbose_name=&#x27;薪资&#x27;, blank=True, null=True)    welfare = models.CharField(verbose_name=&#x27;福利&#x27;, max_length=256, blank=True, null=True)    date = models.DateField(verbose_name=&#x27;入职时间&#x27;, help_text=&#x27;格式yyyy-mm-dd&#x27;, blank=True, null=True)    memo = models.CharField(verbose_name=&#x27;备注&#x27;, max_length=256, blank=True, null=True)    def __str__(self):        return self.customer.nameclass ClassStudyRecord(models.Model):    &quot;&quot;&quot;    上课记录表 （班级记录）    &quot;&quot;&quot;    class_obj = models.ForeignKey(verbose_name=&quot;班级&quot;, to=&quot;ClassList&quot;)    day_num = models.IntegerField(verbose_name=&quot;节次&quot;, help_text=u&quot;此处填写第几节课或第几天课程...,必须为数字&quot;)    teacher = models.ForeignKey(verbose_name=&quot;讲师&quot;, to=&#x27;UserInfo&#x27;,limit_choices_to=&#123;&#x27;depart&#x27;:1002&#125;)    date = models.DateField(verbose_name=&quot;上课日期&quot;, auto_now_add=True)    course_title = models.CharField(verbose_name=&#x27;本节课程标题&#x27;, max_length=64, blank=True, null=True)    course_memo = models.TextField(verbose_name=&#x27;本节课程内容概要&#x27;, blank=True, null=True)    has_homework = models.BooleanField(default=True, verbose_name=&quot;本节有作业&quot;)    homework_title = models.CharField(verbose_name=&#x27;本节作业标题&#x27;, max_length=64, blank=True, null=True)    homework_memo = models.TextField(verbose_name=&#x27;作业描述&#x27;, max_length=500, blank=True, null=True)    exam = models.TextField(verbose_name=&#x27;踩分点&#x27;, max_length=300, blank=True, null=True)    def __str__(self):        return &quot;&#123;0&#125; day&#123;1&#125;&quot;.format(self.class_obj, self.day_num)class StudentStudyRecord(models.Model):    &#x27;&#x27;&#x27;    学生学习记录    &#x27;&#x27;&#x27;    classstudyrecord = models.ForeignKey(verbose_name=&quot;第几天课程&quot;, to=&quot;ClassStudyRecord&quot;)    student = models.ForeignKey(verbose_name=&quot;学员&quot;, to=&#x27;Student&#x27;)    record_choices = ((&#x27;checked&#x27;, &quot;已签到&quot;),                      (&#x27;vacate&#x27;, &quot;请假&quot;),                      (&#x27;late&#x27;, &quot;迟到&quot;),                      (&#x27;noshow&#x27;, &quot;缺勤&quot;),                      (&#x27;leave_early&#x27;, &quot;早退&quot;),                      )    record = models.CharField(&quot;上课纪录&quot;, choices=record_choices, default=&quot;checked&quot;, max_length=64)    score_choices = ((100, &#x27;A+&#x27;),                     (90, &#x27;A&#x27;),                     (85, &#x27;B+&#x27;),                     (80, &#x27;B&#x27;),                     (70, &#x27;B-&#x27;),                     (60, &#x27;C+&#x27;),                     (50, &#x27;C&#x27;),                     (40, &#x27;C-&#x27;),                     (0, &#x27; D&#x27;),                     (-1, &#x27;N/A&#x27;),                     (-100, &#x27;COPY&#x27;),                     (-1000, &#x27;FAIL&#x27;),                     )    score = models.IntegerField(&quot;本节成绩&quot;, choices=score_choices, default=-1)    homework_note = models.CharField(verbose_name=&#x27;作业评语&#x27;, max_length=255, blank=True, null=True)    note = models.CharField(verbose_name=&quot;备注&quot;, max_length=255, blank=True, null=True)    homework = models.FileField(verbose_name=&#x27;作业文件&#x27;, blank=True, null=True, default=None)    stu_memo = models.TextField(verbose_name=&#x27;学员备注&#x27;, blank=True, null=True)    date = models.DateTimeField(verbose_name=&#x27;提交作业日期&#x27;, auto_now_add=True)    def __str__(self):        return &quot;&#123;0&#125;-&#123;1&#125;&quot;.format(self.classstudyrecord, self.student)         &quot;&quot;&quot;chocies参数使用场景是非常广泛的&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="MTV与MVC模型"><a href="#MTV与MVC模型" class="headerlink" title="MTV与MVC模型"></a>MTV与MVC模型</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># MTV:Django号称是MTV模型M:modelsT:templatesV:views# MVC:其实django本质也是MVCM:modelsV:viewsC:controller  # vue框架:MVVM模型</span></span><br></pre></td></tr></table></figure>
<h3 id="多对多三种创建方式"><a href="#多对多三种创建方式" class="headerlink" title="多对多三种创建方式"></a>多对多三种创建方式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全自动:利用orm自动帮我们创建第三张关系表	class Book(models.Model):    name = models.CharField(max_length=32)    authors = models.ManyToManyField(to=&#x27;Author&#x27;)	class Author(models.Model):    name = models.CharField(max_length=32)	&quot;&quot;&quot;	优点:代码不需要你写 非常的方便 还支持orm提供操作第三张关系表的方法...	不足之处:第三张关系表的扩展性极差(没有办法额外添加字段...)	&quot;&quot;&quot;# 纯手动	class Book(models.Model):    name = models.CharField(max_length=32)    	class Author(models.Model):    name = models.CharField(max_length=32)    class Book2Author(models.Model):    book_id = models.ForeignKey(to=&#x27;Book&#x27;)    author_id = models.ForeignKey(to=&#x27;Author&#x27;)  &#x27;&#x27;&#x27;  优点:第三张表完全取决于你自己进行额外的扩展  不足之处:需要写的代码较多，不能够再使用orm提供的简单的方法  不建议你用该方式  &#x27;&#x27;&#x27;# 半自动class Book(models.Model):    name = models.CharField(max_length=32)    authors = models.ManyToManyField(to=&#x27;Author&#x27;,                                     through=&#x27;Book2Author&#x27;,                                     through_fields=(&#x27;book&#x27;,&#x27;author&#x27;)                                     )class Author(models.Model):    name = models.CharField(max_length=32)    # books = models.ManyToManyField(to=&#x27;Book&#x27;,    #                                  through=&#x27;Book2Author&#x27;,    #                                  through_fields=(&#x27;author&#x27;,&#x27;book&#x27;)    #                                  )class Book2Author(models.Model):    book = models.ForeignKey(to=&#x27;Book&#x27;)    author = models.ForeignKey(to=&#x27;Author&#x27;)&quot;&quot;&quot;through_fields字段先后顺序    判断的本质：        通过第三张表查询对应的表 需要用到哪个字段就把哪个字段放前面    你也可以简化判断        当前表是谁 就把对应的关联字段放前面                半自动:可以使用orm的正反向查询 但是没法使用add,set,remove,clear这四个方法&quot;&quot;&quot;# 总结:你需要掌握的是全自动和半自动 为了扩展性更高 一般我们都会采用半自动(写代码要给自己留一条后路)</span></span><br></pre></td></tr></table></figure>
<h3 id><a href="#" class="headerlink" title></a></h3></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">NephrenCake</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://nephrencake.gitee.io/2021/06/Django-Part5/">https://nephrencake.gitee.io/2021/06/Django-Part5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://nephrencake.gitee.io" target="_blank">浅幽丶奈芙莲的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/2021/06/Django-Part5/%E4%B8%80ed11.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/Django-Part6/"><img class="prev-cover" src="/2021/06/Django-Part6/%E4%B8%80ed12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Django-Part6</div></div></a></div><div class="next-post pull-right"><a href="/2021/06/Django-Part4/"><img class="next-cover" src="/2021/06/Django-Part4/%E4%B8%80ed10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Django-Part4</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Django-Part5%E2%80%94%E2%80%94%E6%A8%A1%E5%9E%8B%E5%B1%82"><span class="toc-number">1.</span> <span class="toc-text">Django-Part5——模型层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC"><span class="toc-number">1.1.</span> <span class="toc-text">测试脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.2.</span> <span class="toc-text">单表操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%85%E7%9F%A5%E5%BF%85%E4%BC%9A13%E6%9D%A1"><span class="toc-number">1.2.1.</span> <span class="toc-text">必知必会13条</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%86%85%E9%83%A8sql%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.2.2.</span> <span class="toc-text">查看内部sql语句的方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.2.3.</span> <span class="toc-text">双下划线查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%A4%96%E9%94%AE%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">1.2.4.</span> <span class="toc-text">一对多外键增删改查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%A4%96%E9%94%AE%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">1.2.5.</span> <span class="toc-text">多对多外键增删改查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%8F%8D%E5%90%91%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.6.</span> <span class="toc-text">正反向的概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2-%E5%9F%BA%E4%BA%8E%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.1.</span> <span class="toc-text">子查询(基于对象的跨表查询)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%94%E8%A1%A8%E6%9F%A5%E8%AF%A2-%E5%9F%BA%E4%BA%8E%E5%8F%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E7%9A%84%E8%B7%A8%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.2.</span> <span class="toc-text">联表查询(基于双下划线的跨表查询)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.3.</span> <span class="toc-text">聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.4.</span> <span class="toc-text">分组查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#F%E4%B8%8EQ%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.5.</span> <span class="toc-text">F与Q查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#django%E4%B8%AD%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.3.6.</span> <span class="toc-text">django中如何开启事务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orm%E4%B8%AD%E5%B8%B8%E7%94%A8%E5%AD%97%E6%AE%B5%E5%8F%8A%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.7.</span> <span class="toc-text">orm中常用字段及参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.8.</span> <span class="toc-text">数据库查询优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E4%B9%A6%E7%AE%A1%E7%90%86%E7%9A%84%E5%9B%BE%E4%B9%A6%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5"><span class="toc-number">1.3.9.</span> <span class="toc-text">图书管理的图书增删改查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#choices%E5%8F%82%E6%95%B0-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%97%E6%AE%B5%E8%AE%BE%E8%AE%A1%E5%B8%B8%E8%A7%81"><span class="toc-number">1.3.10.</span> <span class="toc-text">choices参数(数据库字段设计常见)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MTV%E4%B8%8EMVC%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.11.</span> <span class="toc-text">MTV与MVC模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A%E4%B8%89%E7%A7%8D%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">1.3.12.</span> <span class="toc-text">多对多三种创建方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.3.13.</span> <span class="toc-text"></span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 By NephrenCake</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">这里是浅幽丶奈芙莲的个人博客~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script></div></body></html>